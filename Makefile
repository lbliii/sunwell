# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# Sunwell โ AI-Native Development
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

.PHONY: help studio studio-dev studio-build install check clean

# Default target
help:
	@echo ""
	@echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
	@echo "  โ              โ๏ธ  SUNWELL DEVELOPMENT COMMANDS                  โ"
	@echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
	@echo ""
	@echo "  Usage: make <command>"
	@echo ""
	@echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
	@echo "  โ STUDIO (GUI)                                                    โ"
	@echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค"
	@echo "  โ studio        Run Sunwell Studio (demo mode)                    โ"
	@echo "  โ studio-dev    Run Studio with hot reload                        โ"
	@echo "  โ studio-build  Build Studio for production                       โ"
	@echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค"
	@echo "  โ CORE (CLI)                                                      โ"
	@echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค"
	@echo "  โ install       Install Sunwell CLI (editable)                    โ"
	@echo "  โ agent         Run agent with a goal (GOAL='...')                โ"
	@echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค"
	@echo "  โ DEVELOPMENT                                                     โ"
	@echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค"
	@echo "  โ check         Run linters and type checks                       โ"
	@echo "  โ test          Run tests                                         โ"
	@echo "  โ clean         Clean build artifacts                             โ"
	@echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
	@echo ""

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# STUDIO COMMANDS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Run Sunwell Studio (demo mode, hot reload)
studio: studio-deps
	@echo "โ๏ธ  Starting Sunwell Studio..."
	@cd studio && npm run tauri dev

# Alias for studio
studio-dev: studio

# Install studio dependencies if needed
studio-deps:
	@if [ ! -d "studio/node_modules" ]; then \
		echo "๐ฆ Installing Studio dependencies..."; \
		cd studio && npm install; \
	fi
	@if ! command -v cargo &> /dev/null; then \
		echo "โ๏ธ  Rust not found. Install with: curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh"; \
		exit 1; \
	fi

# Build Studio for production
studio-build: studio-deps
	@echo "๐จ Building Sunwell Studio..."
	@cd studio && npm run tauri build

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# CORE COMMANDS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Install Sunwell CLI in development mode
install:
	@echo "๐ฆ Installing Sunwell..."
	@pip install -e ".[dev]"

# Run agent with a goal
# Usage: make agent GOAL="Build a Flask API"
agent:
ifndef GOAL
	@echo "Usage: make agent GOAL='your goal here'"
	@exit 1
endif
	@sunwell agent run "$(GOAL)"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# DEVELOPMENT COMMANDS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Verify Python environment
env:
	@python -c "import sys; ft = not sys._is_gil_enabled() if hasattr(sys, '_is_gil_enabled') else False; print('Python:', sys.version.split()[0], '(free-threaded)' if ft else '(GIL enabled - WRONG!)')"

# Run all checks
check: env
	@echo "๐ Running checks..."
	@ruff check src/
	@ty check src/

# Run tests
test:
	@echo "๐งช Running tests..."
	@pytest tests/ -v

# Clean build artifacts
clean:
	@echo "๐งน Cleaning..."
	@rm -rf build/ dist/ *.egg-info .pytest_cache .ruff_cache
	@rm -rf studio/dist studio/node_modules/.cache
	@rm -rf studio/src-tauri/target
	@find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	@echo "โจ Clean!"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# QUICK START
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# First-time setup
setup: install studio-deps
	@echo ""
	@echo "โ Setup complete! Run 'make studio' to start."
