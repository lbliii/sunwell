---
alwaysApply: true
---

# Python Style Guide (ruff + ty compliant)

## Imports
- Standard library first, then third-party, then local (isort handles this)
- Use `from __future__ import annotations` only if needed for forward refs
- Prefer explicit imports over `from x import *`

## Line Length
- Max 100 characters
- Break long function signatures after `(`, align params

## Type Annotations
- Always annotate public functions
- Use `| None` over `Optional[X]` (Python 3.10+)
- Use `list[X]` over `List[X]` (Python 3.9+)
- Use `type[X]` over `Type[X]`

## Free-Threading (3.14t) Patterns
- Avoid module-level mutable state
- Use `threading.Lock` for shared state, not global singletons
- Prefer `contextvars` for thread-local-like behavior
- No `@cache`/`@lru_cache` on methods without care (not thread-safe by default)

## Common Ruff Fixes I Should Apply Automatically
- UP: Use modern syntax (`match`, `|` unions, f-strings, etc.)
- SIM: Simplify conditionals (`if x is not None` vs `if x != None`)
- B: Avoid mutable default args, don't use `assert` for validation